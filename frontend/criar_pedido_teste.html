<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Criar Pedido de Teste</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .result {
        margin: 10px 0;
        padding: 10px;
        border-radius: 4px;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>ðŸ›’ Criar Pedido de Teste</h1>

    <div id="results"></div>

    <button onclick="criarPedidoTeste()">ðŸš€ Criar Pedido de Teste</button>
    <button onclick="verificarPedidos()">ðŸ“‹ Ver Pedidos Existentes</button>
    <button onclick="limparResultados()">ðŸ§¹ Limpar</button>

    <script>
      function addResult(message, type = "info") {
        const div = document.createElement("div");
        div.className = `result ${type}`;
        div.textContent = message;
        document.getElementById("results").appendChild(div);
      }

      function limparResultados() {
        document.getElementById("results").innerHTML = "";
      }

      function verificarPedidos() {
        addResult("ðŸ“‹ Verificando pedidos existentes...", "info");

        try {
          const storage = JSON.parse(
            localStorage.getItem("oursales:data") || "{}"
          );
          const pedidos = storage.pedidos || [];

          if (pedidos.length === 0) {
            addResult("âŒ Nenhum pedido encontrado", "info");
          } else {
            addResult(`âœ… Encontrados ${pedidos.length} pedido(s):`, "success");
            pedidos.forEach((pedido, index) => {
              addResult(
                `${index + 1}. ${pedido.codigo || pedido.id} - ${
                  pedido.clienteNome || "Sem cliente"
                }`,
                "success"
              );
            });
          }
        } catch (error) {
          addResult(`âŒ Erro ao verificar pedidos: ${error.message}`, "info");
        }
      }

      function criarPedidoTeste() {
        addResult("ðŸš€ Criando pedido de teste...", "info");

        try {
          // Carregar dados existentes
          const storage = JSON.parse(
            localStorage.getItem("oursales:data") || "{}"
          );

          // Verificar se hÃ¡ clientes e transportadoras
          const clientes = storage.clientes || [];
          const transportadoras = storage.transportadoras || [];

          if (clientes.length === 0) {
            addResult(
              "âŒ Nenhum cliente cadastrado. Criando cliente de teste...",
              "info"
            );

            // Criar cliente de teste
            const clienteTeste = {
              id: "cli-teste-pedido",
              tipo: "PJ",
              nome: "Empresa Teste LTDA",
              documento: "12.345.678/0001-99",
              email: "teste@empresa.com",
              telefone: "(11) 99999-9999",
              observacoes: "Cliente criado para teste de pedidos",
            };

            storage.clientes = storage.clientes || [];
            storage.clientes.push(clienteTeste);
            addResult("âœ… Cliente de teste criado", "success");
          }

          if (transportadoras.length === 0) {
            addResult(
              "âŒ Nenhuma transportadora cadastrada. Criando transportadora de teste...",
              "info"
            );

            // Criar transportadora de teste
            const transportadoraTeste = {
              id: "tra-teste-pedido",
              nome: "Transportadora Teste",
              prazo: 5,
              custo: 150,
              cobertura: "SÃ£o Paulo e regiÃ£o",
            };

            storage.transportadoras = storage.transportadoras || [];
            storage.transportadoras.push(transportadoraTeste);
            addResult("âœ… Transportadora de teste criada", "success");
          }

          // Criar pedido de teste
          const pedidoTeste = {
            id: "ped-teste-" + Date.now(),
            codigo: "PED-2024-TESTE-" + Math.floor(Math.random() * 1000),
            clienteId: storage.clientes[0].id,
            clienteNome: storage.clientes[0].nome,
            transportadoraId: storage.transportadoras[0].id,
            transportadoraNome: storage.transportadoras[0].nome,
            dataVenda: new Date().toISOString().split("T")[0],
            previsaoEntrega: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
              .toISOString()
              .split("T")[0],
            valor: 2500.0,
            status: "pendente",
            observacoes: "Pedido criado para teste da funcionalidade de ediÃ§Ã£o",
            tipo: "pedido",
            vendedor: "Vendedor Teste",
            condicaoPagamento: "Ã€ vista com 5% de desconto",
            enderecoEntrega: "Rua Teste, 123 - Centro - SÃ£o Paulo/SP",
          };

          // Adicionar pedido
          storage.pedidos = storage.pedidos || [];
          storage.pedidos.push(pedidoTeste);

          // Salvar no localStorage
          localStorage.setItem("oursales:data", JSON.stringify(storage));

          addResult("ðŸŽ‰ Pedido de teste criado com sucesso!", "success");
          addResult(`ðŸ“¦ CÃ³digo: ${pedidoTeste.codigo}`, "success");
          addResult(`ðŸ‘¤ Cliente: ${pedidoTeste.clienteNome}`, "success");
          addResult(
            `ðŸšš Transportadora: ${pedidoTeste.transportadoraNome}`,
            "success"
          );
          addResult(`ðŸ’° Valor: R$ ${pedidoTeste.valor.toFixed(2)}`, "success");
          addResult(`ðŸ“… Data de Venda: ${pedidoTeste.dataVenda}`, "success");
          addResult(
            `ðŸ“… PrevisÃ£o de Entrega: ${pedidoTeste.previsaoEntrega}`,
            "success"
          );
          addResult(`ðŸ“ Status: ${pedidoTeste.status}`, "success");

          addResult(
            "âœ… Agora vocÃª pode testar a ediÃ§Ã£o deste pedido!",
            "success"
          );
        } catch (error) {
          addResult(`âŒ Erro ao criar pedido: ${error.message}`, "info");
        }
      }

      // Executar verificaÃ§Ã£o automÃ¡tica
      window.addEventListener("load", () => {
        addResult(
          'ðŸŽ¯ PÃ¡gina carregada. Clique em "Criar Pedido de Teste" para criar um pedido.',
          "info"
        );
        verificarPedidos();
      });
    </script>
  </body>
</html>

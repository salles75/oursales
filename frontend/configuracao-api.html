<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OurSales ‚Ä¢ Configura√ß√£o API</title>
    <link rel="stylesheet" href="assets/css/style.css" />
    <style>
      .config-card {
        background: white;
        border-radius: 8px;
        padding: 2rem;
        margin: 2rem auto;
        max-width: 600px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .status-badge {
        display: inline-block;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        font-weight: bold;
        margin: 0.5rem 0;
      }

      .status-local {
        background: #e3f2fd;
        color: #1976d2;
      }

      .status-api {
        background: #e8f5e9;
        color: #388e3c;
      }

      .mode-selector {
        display: flex;
        gap: 1rem;
        margin: 1.5rem 0;
      }

      .mode-option {
        flex: 1;
        padding: 1rem;
        border: 2px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
      }

      .mode-option:hover {
        border-color: #007bff;
        background: #f8f9fa;
      }

      .mode-option.active {
        border-color: #007bff;
        background: #007bff;
        color: white;
      }

      .info-box {
        background: #f8f9fa;
        border-left: 4px solid #007bff;
        padding: 1rem;
        margin: 1rem 0;
      }

      .test-section {
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid #eee;
      }

      .test-result {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 4px;
        margin: 1rem 0;
        font-family: monospace;
        white-space: pre-wrap;
        max-height: 300px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body data-page="configuracao">
    <header>
      <h1>‚öôÔ∏è Configura√ß√£o da API</h1>
      <p>Configure como o sistema armazena e sincroniza dados</p>
    </header>

    <nav>
      <div class="nav-inner">
        <a href="index.html" data-page="home">In√≠cio</a>
        <a href="clientes.html" data-page="clientes">Clientes</a>
        <a href="orcamentos.html" data-page="orcamentos">Or√ßamentos</a>
        <a href="pedidos.html" data-page="pedidos">Pedidos</a>
        <a href="produtos.html" data-page="produtos">Produtos</a>
        <a href="industrias.html" data-page="industrias">Ind√∫strias</a>
        <a href="crm.html" data-page="crm">CRM</a>
        <a href="configuracoes.html" data-page="configuracoes">‚öôÔ∏è Mais</a>
      </div>
    </nav>

    <main>
      <div class="config-card">
        <h2>Modo de Opera√ß√£o</h2>

        <div class="info-box">
          <strong>Status Atual:</strong>
          <div>
            <span id="statusAtual" class="status-badge">Carregando...</span>
          </div>
        </div>

        <div class="mode-selector">
          <div
            class="mode-option"
            id="modoLocal"
            onclick="selecionarModo('local')"
          >
            <h3>üîµ Modo Local</h3>
            <p>Dados salvos no navegador</p>
            <small>Funciona offline</small>
          </div>

          <div class="mode-option" id="modoApi" onclick="selecionarModo('api')">
            <h3>üü¢ Modo API</h3>
            <p>Conectado ao backend</p>
            <small>Requer servidor rodando</small>
          </div>
        </div>

        <div class="info-box">
          <h4>‚ÑπÔ∏è Informa√ß√µes</h4>
          <ul>
            <li>
              <strong>Modo Local:</strong> Dados ficam apenas no seu navegador.
              Ideal para testes e desenvolvimento.
            </li>
            <li>
              <strong>Modo API:</strong> Dados s√£o salvos no servidor
              PostgreSQL. Ideal para uso em produ√ß√£o.
            </li>
            <li>Voc√™ pode alternar entre os modos a qualquer momento.</li>
            <li>
              Para usar o Modo API, certifique-se que o backend est√° rodando em
              <code>http://localhost:3000</code>
            </li>
          </ul>
        </div>

        <button
          type="button"
          onclick="aplicarModo()"
          class="button-primary"
          style="width: 100%; padding: 1rem; font-size: 1.1rem"
        >
          Aplicar e Recarregar
        </button>

        <div class="test-section">
          <h3>üß™ Testar Conex√£o com API</h3>
          <p>Verifique se o backend est√° rodando e acess√≠vel</p>

          <button
            type="button"
            onclick="testarConexao()"
            class="button-secondary"
            style="width: 100%; margin-top: 0.5rem"
          >
            Testar Conex√£o
          </button>

          <div id="testResult" class="test-result" style="display: none"></div>
        </div>
      </div>
    </main>

    <footer>
      Configure o modo de opera√ß√£o que melhor se adapta √†s suas necessidades.
    </footer>

    <script type="module">
      let modoSelecionado = localStorage.getItem("oursales:mode") || "local";

      function atualizarInterface() {
        const modo = localStorage.getItem("oursales:mode") || "local";
        modoSelecionado = modo;

        // Atualizar badge de status
        const statusEl = document.getElementById("statusAtual");
        if (modo === "local") {
          statusEl.textContent = "üîµ Modo Local";
          statusEl.className = "status-badge status-local";
        } else {
          statusEl.textContent = "üü¢ Modo API";
          statusEl.className = "status-badge status-api";
        }

        // Atualizar sele√ß√£o visual
        document
          .getElementById("modoLocal")
          .classList.toggle("active", modo === "local");
        document
          .getElementById("modoApi")
          .classList.toggle("active", modo === "api");
      }

      window.selecionarModo = function (modo) {
        modoSelecionado = modo;
        document
          .getElementById("modoLocal")
          .classList.toggle("active", modo === "local");
        document
          .getElementById("modoApi")
          .classList.toggle("active", modo === "api");
      };

      window.aplicarModo = function () {
        localStorage.setItem("oursales:mode", modoSelecionado);
        alert(
          `Modo alterado para: ${
            modoSelecionado === "local" ? "Local" : "API"
          }\n\nA p√°gina ser√° recarregada.`
        );
        location.reload();
      };

      window.testarConexao = async function () {
        const resultEl = document.getElementById("testResult");
        resultEl.style.display = "block";
        resultEl.textContent = "Testando conex√£o...";

        try {
          const response = await fetch("http://localhost:3000/health");
          const data = await response.json();

          if (data.status === "healthy") {
            resultEl.innerHTML = `‚úÖ <strong>Conex√£o bem-sucedida!</strong>\n\n${JSON.stringify(
              data,
              null,
              2
            )}`;
            resultEl.style.background = "#e8f5e9";
            resultEl.style.borderLeft = "4px solid #4caf50";
          } else {
            resultEl.innerHTML = `‚ö†Ô∏è <strong>Servidor respondeu mas n√£o est√° saud√°vel</strong>\n\n${JSON.stringify(
              data,
              null,
              2
            )}`;
            resultEl.style.background = "#fff3e0";
            resultEl.style.borderLeft = "4px solid #ff9800";
          }
        } catch (error) {
          resultEl.innerHTML = `‚ùå <strong>Erro ao conectar ao backend</strong>\n\nErro: ${error.message}\n\nCertifique-se que o backend est√° rodando em http://localhost:3000`;
          resultEl.style.background = "#ffebee";
          resultEl.style.borderLeft = "4px solid #f44336";
        }
      };

      // Atualizar interface ao carregar
      atualizarInterface();
    </script>
  </body>
</html>




<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Criar Pedido e Testar</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      .card {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
      }
      button {
        padding: 12px 24px;
        margin: 5px;
        cursor: pointer;
        border: none;
        border-radius: 4px;
        font-size: 16px;
      }
      .btn-primary {
        background: #007bff;
        color: white;
      }
      .btn-secondary {
        background: #6c757d;
        color: white;
      }
      .btn-success {
        background: #28a745;
        color: white;
      }
      .result {
        margin: 10px 0;
        padding: 10px;
        border-radius: 4px;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      code {
        background: #f4f4f4;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ›’ Criar e Testar Pedido</h1>

      <div class="card">
        <h2>ğŸ“‹ InstruÃ§Ãµes</h2>
        <p>
          Este script vai criar um pedido de teste completo e depois
          redirecionar vocÃª para testÃ¡-lo.
        </p>
      </div>

      <div class="card">
        <h2>ğŸš€ AÃ§Ãµes</h2>
        <button class="btn-primary" onclick="criarPedido()">
          1ï¸âƒ£ Criar Pedido de Teste
        </button>
        <button class="btn-secondary" onclick="irParaPedidos()">
          2ï¸âƒ£ Ir para Lista de Pedidos
        </button>
        <button class="btn-success" onclick="limparStorage()">
          ğŸ—‘ï¸ Limpar Dados de Teste
        </button>
      </div>

      <div id="results"></div>
    </div>

    <script>
      function addResult(message, type = "info") {
        const div = document.createElement("div");
        div.className = `result ${type}`;
        div.innerHTML = message;
        document.getElementById("results").appendChild(div);
      }

      function limparStorage() {
        if (
          confirm("Isso vai limpar TODOS os dados do sistema. Tem certeza?")
        ) {
          localStorage.clear();
          addResult(
            "âœ… Dados limpos. Recarregue a pÃ¡gina para comeÃ§ar do zero.",
            "warning"
          );
        }
      }

      function irParaPedidos() {
        window.location.href = "pedidos.html";
      }

      function criarPedido() {
        addResult("ğŸš€ Criando pedido de teste...", "info");

        try {
          // Carregar dados existentes
          let storage = JSON.parse(
            localStorage.getItem("oursales:data") || "{}"
          );

          // Garantir arrays
          storage.clientes = storage.clientes || [];
          storage.transportadoras = storage.transportadoras || [];
          storage.pedidos = storage.pedidos || [];

          // Verificar se hÃ¡ clientes
          if (storage.clientes.length === 0) {
            addResult(
              "âš ï¸ Nenhum cliente cadastrado. Criando cliente de teste...",
              "warning"
            );

            const clienteTeste = {
              id: "cli-teste-" + Date.now(),
              tipo: "PJ",
              nome: "Empresa Teste LTDA",
              fantasia: "Teste",
              documento: "12.345.678/0001-99",
              email: "teste@empresa.com",
              telefone: "(11) 99999-9999",
              observacoes: "Cliente criado para teste",
            };

            storage.clientes.push(clienteTeste);
            addResult("âœ… Cliente de teste criado", "success");
          }

          // Verificar se hÃ¡ transportadoras
          if (storage.transportadoras.length === 0) {
            addResult(
              "âš ï¸ Nenhuma transportadora cadastrada. Criando transportadora de teste...",
              "warning"
            );

            const transportadoraTeste = {
              id: "tra-teste-" + Date.now(),
              nome: "Transportadora Express",
              prazo: 5,
              custo: 150,
              cobertura: "SÃ£o Paulo e regiÃ£o",
            };

            storage.transportadoras.push(transportadoraTeste);
            addResult("âœ… Transportadora de teste criada", "success");
          }

          // Criar pedido de teste
          const hoje = new Date();
          const entrega = new Date(hoje.getTime() + 10 * 24 * 60 * 60 * 1000);

          const pedidoTeste = {
            id: "ped-teste-" + Date.now(),
            codigo: "PED-2024-TESTE-" + Math.floor(Math.random() * 9999),
            clienteId: storage.clientes[0].id,
            clienteNome: storage.clientes[0].nome,
            transportadoraId: storage.transportadoras[0].id,
            transportadoraNome: storage.transportadoras[0].nome,
            dataVenda: hoje.toISOString().split("T")[0],
            previsaoEntrega: entrega.toISOString().split("T")[0],
            dataFatura: "",
            notaFiscal: "",
            valor: 3500.0,
            status: "pendente",
            observacoes:
              "Pedido criado para teste da funcionalidade de ediÃ§Ã£o. Este pedido contÃ©m dados fictÃ­cios para validaÃ§Ã£o do sistema.",
            tipo: "pedido",
            vendedor: "guilherme",
            condicaoPagamento: "Ã€ vista com 5% de desconto",
            enderecoEntrega:
              "Rua Teste, 123 - Centro - SÃ£o Paulo/SP - CEP: 01234-567",
            fatorCubagem: 300,
            ordemCompra: "OC-2024-001",
            numeroERP: "ERP-12345",
            cancelado: false,
          };

          // Adicionar pedido
          storage.pedidos.push(pedidoTeste);

          // Salvar no localStorage
          localStorage.setItem("oursales:data", JSON.stringify(storage));

          addResult("<h3>ğŸ‰ Pedido criado com sucesso!</h3>", "success");
          addResult(
            `<strong>ğŸ“¦ CÃ³digo:</strong> ${pedidoTeste.codigo}`,
            "success"
          );
          addResult(
            `<strong>ğŸ‘¤ Cliente:</strong> ${pedidoTeste.clienteNome}`,
            "success"
          );
          addResult(
            `<strong>ğŸšš Transportadora:</strong> ${pedidoTeste.transportadoraNome}`,
            "success"
          );
          addResult(
            `<strong>ğŸ’° Valor:</strong> R$ ${pedidoTeste.valor.toFixed(2)}`,
            "success"
          );
          addResult(
            `<strong>ğŸ“… Data de Venda:</strong> ${pedidoTeste.dataVenda}`,
            "success"
          );
          addResult(
            `<strong>ğŸ“… PrevisÃ£o de Entrega:</strong> ${pedidoTeste.previsaoEntrega}`,
            "success"
          );
          addResult(
            `<strong>ğŸ“ Status:</strong> ${pedidoTeste.status}`,
            "success"
          );
          addResult(
            `<strong>ğŸ·ï¸ ID do Pedido:</strong> <code>${pedidoTeste.id}</code>`,
            "info"
          );

          addResult(
            "<h3>âœ… PrÃ³ximos passos:</h3>" +
              "<ol>" +
              "<li>Clique em '2ï¸âƒ£ Ir para Lista de Pedidos'</li>" +
              "<li>Selecione o pedido recÃ©m-criado</li>" +
              "<li>Clique em 'Editar'</li>" +
              "<li>Verifique se abre a pÃ¡gina completa (nÃ£o um pop-up)</li>" +
              "<li>Verifique se os campos estÃ£o prÃ©-preenchidos</li>" +
              "<li>FaÃ§a alteraÃ§Ãµes e salve</li>" +
              "</ol>",
            "info"
          );

          // Auto-scroll para os resultados
          document
            .getElementById("results")
            .scrollIntoView({ behavior: "smooth" });
        } catch (error) {
          addResult(`âŒ Erro ao criar pedido: ${error.message}`, "warning");
          console.error("Erro detalhado:", error);
        }
      }

      // Verificar pedidos existentes ao carregar
      window.addEventListener("load", () => {
        try {
          const storage = JSON.parse(
            localStorage.getItem("oursales:data") || "{}"
          );
          const pedidos = storage.pedidos || [];

          addResult(
            `ğŸ“Š Sistema possui <strong>${pedidos.length}</strong> pedido(s) cadastrado(s)`,
            "info"
          );

          if (pedidos.length > 0) {
            addResult(
              "ğŸ’¡ <strong>Dica:</strong> VocÃª pode criar um novo pedido de teste ou usar um existente.",
              "info"
            );
          }
        } catch (error) {
          addResult(
            "âš ï¸ Sistema sem dados. Criar um pedido de teste...",
            "warning"
          );
        }
      });
    </script>
  </body>
</html>



